<!--
FileName : index.html
ProjectName : 七夕
Author : terrorblade
Created Date: 2019-07-24 12:57:23
Description : 
-----
Last Modified: 2019-08-06 17:23:14
Modified By : 
-----
Copyright (c) 2019 芒果动听 Corporation. All rights reserved.
-->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <!-- <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
        /> -->
		<title></title>
		<style>
			*{
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				-webkit-tap-highlight-color:rgba(0,0,0,0);
				outline:none;
				background: none;
			}
			html,body{
				display: block;
				position: fixed;
				top:0;
				left:0;
				width:100%;
				height:100%;
			}
			#box{
				font-size: 36px;
				white-space:pre;
			}
			#play{
				position: fixed;
				width:88px;
				height:88px;
				top:40px;
				right: 40px;
			}
			#play img{
				display: inline-block;
				width:88px;
				height:88px;
			}
			#play .icon{
				display: flex;
				align-items: center;
				position: absolute;
				top: 20px;
				left: -100px;
				color: #d4237a;
				display: none;
			}
			#play .icon span{
				font-size:20px;
				white-space: nowrap;
			}
			#play .icon i{
				display: inline-block;
				width:40px;
				height:40px;
				background: url('./right.png') no-repeat center center;
				background-size:100% 100%;
			}
			@keyframes rotating{
				from{transform:rotate(0)}
				to{transform:rotate(360deg)}
			}
			.rote{animation:rotating 8s linear infinite}
		</style>
    </head>
    <body>
		<div id="play">
			<img src="./audio.png" alt="">
			<div class="icon">
				<span>戳一下</span>
				<i></i>
			</div>
		</div>
		<img src="./flower.jpg" alt="" id="flower" style="display:none">
		<canvas id="drawing"></canvas>
		<!-- <div id="box"></div> -->
		<pre id="box"></pre>
		<audio src="http://w1.tingdao.com/web/audio/cs001.m4a" autoplay="true" style="display: none" id="audio" loop="true"></audio>
		<script  type="text/javascript" src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
        <script type="text/javascript" src="https://tdbucketdefault.oss-cn-shanghai.aliyuncs.com/web/vconsole.min.js"></script>
        <script  type="text/javascript" src="./base.js"></script>
		<script type="text/javascript">
			class Init {
				constructor() {
					this.radian = 0;
					this.radian_add = Math.PI / 40;
					this.flag = true;
					this.imgUrl = 'http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo2WpT3vkNQ3KVLicsUPboO7OQqFlBH9BRdzBrOiaHUFDrvnsthQBlBbshU1sRUZ9deY4wwp8jEFQrg/132';
					this.text = '冯小姐七夕快乐:'+"\n"+'\v\v'+'世界很大，让不同城市的两个人相遇,'+'\n\v\v'+
					'世界很小，相遇的两个人却又分割两地，'+'\n\v\v'+
					'既然遇见了，不得不让我相信这是宿命，'+'\n\v\v'+
					'相识了，不得不让我相信这是缘分，'+'\n\v\v'+
					'然后我期待我们能相知->相爱，一生一世的陪伴';
					var drawing = document.getElementById("drawing");
					this.pic = document.getElementById('flower'); //获取描边图片
					this.width = document.documentElement.clientWidth;
					drawing.width = this.width;
					drawing.height = this.width;
					this.content = drawing.getContext("2d");
					this.content.translate(this.width/2,this.width/2);
					this.box = document.getElementById("box");
					this.event();
					base.weShare('送给冯小姐的一封信','来自遥远的陈先生',this.imgUrl,location.href);
					this.intervalId = setInterval(()=>{
						this.heart();
					},100);  //设置间歇调用，间隔为100ms
					this.intervalId2 = setInterval(()=>{
						this.showText();
					},300)
				}
				getX1(t) {  //获取心型线的X坐标
					return 15 * (16 * Math.pow(Math.sin(t), 3))
				}
				getY1(t) {  //获取心型线的Y坐标
					return -15 * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t))
				}
				heart() {
					let X = this.getX1(this.radian);
					let Y = this.getY1(this.radian);
					this.content.drawImage(this.pic,X,Y,25,25);   //在给定坐标绘制给定大小的图片
					this.radian+=this.radian_add;
					if (this.radian > (2*Math.PI)){ //绘制完整的心型线后取消间歇调用 
						clearInterval(this.intervalId);
						this.content.font="bold 14px Arial";
						this.content.textAlign="center";
						this.content.color="red";
						this.content.textBaseline="middle";
						this.content.fillText("I LOVE YOU",100,20);
					}
				}
				showText(){
					this.box.innerText = this.text.substring(0,this.index++)+`${this.flag?'_':''}`;
					this.flag = !this.flag;
					if (this.index> this.text.length) {
						clearInterval(this.intervalId2);
					}
				}
				event() {
					if (base.isWx()) {
						console.log("------iswx",base.isWx())
						document.addEventListener('WeixinJSBridgeReady', function () {
							document.querySelector('#audio').play();
							document.querySelector('#play img').classList.add('rote');
						}, false)
					} else {
						document.querySelector('#play .icon').style.display = 'flex';
					}
					$("#play").click(()=>{
						const audio = document.querySelector("#audio");
						if (audio.paused) {
							audio.play();
							document.querySelector('#play img').classList.add('rote');
						} else {
							audio.pause();
							document.querySelector('#play img').classList.remove('rote');
						}
					})
				}
			}
			new Init();
		</script>
    </body>
</html>
